import { ChartType } from '../../src';
import { getChartSpecWithContext } from '../../src/atom/chartGenerator/spec';
import { parseCSVData } from '../../src/utils/dataTable';

describe('getChartSpecWithContext', () => {
  it('should generate correct basic treemap spec', () => {
    const { dataset } = parseCSVData(`Category-0,Category-1,Category-2,Category-3,value
query,methods,add,,593
query,methods,and,,330
query,methods,average,,287
query,methods,count,,277
query,methods,distinct,,292
query,methods,div,,595
query,methods,eq,,594
query,methods,fn,,460
query,methods,gt,,603
query,methods,gte,,625
query,methods,iff,,748
query,methods,isa,,461
query,methods,lt,,597
query,methods,lte,,619
query,methods,max,,283
query,methods,min,,283
query,methods,mod,,591
query,methods,mul,,603
query,methods,neq,,599
query,methods,not,,386
query,methods,or,,323
query,methods,orderby,,307
query,methods,range,,772
query,methods,select,,296
query,methods,stddev,,363
query,methods,sub,,600
query,methods,sum,,280
query,methods,update,,307
query,methods,variance,,335
query,methods,where,,299
query,methods,xor,,354
query,methods,_,,264
query,AggregateExpression,,,1616
query,And,,,1027
query,Arithmetic,,,3891
query,Average,,,891
query,BinaryExpression,,,2893
query,Comparison,,,5103
query,CompositeExpression,,,3677
query,Count,,,781
query,DateUtil,,,4141
query,Distinct,,,933
query,Expression,,,5130
query,ExpressionIterator,,,3617
query,Fn,,,3240
query,If,,,2732
query,IsA,,,2039
query,Literal,,,1214
query,Match,,,3748
query,Maximum,,,843
query,Minimum,,,843
query,Not,,,1554
query,Or,,,970
query,Query,,,13896
query,Range,,,1594
query,StringUtil,,,4130
query,Sum,,,791
query,Variable,,,1124
query,Variance,,,1876
query,Xor,,,1101
util,palette,ColorPalette,,6367
util,palette,Palette,,1229
util,palette,ShapePalette,,2059
util,palette,valuePalette,,2291
util,math,DenseMatrix,,3165
util,math,IMatrix,,2815
util,math,SparseMatrix,,3366
util,heap,FibonacciHeap,,9354
util,heap,HeapNode,,1233
util,Arrays,,,8258
util,Colors,,,10001
util,Dates,,,8217
util,Displays,,,12555
util,Filter,,,2324
util,Geometry,,,10993
util,IEvaluable,,,335
util,IPredicate,,,383
util,IValueProxy,,,874
util,Maths,,,17705
util,Orientation,,,1486
util,Property,,,5559
util,Shapes,,,19118
util,Sort,,,6887
util,Stats,,,6557
util,Strings,,,22026
animate,interpolate,ArrayInterpolator,,1983
animate,interpolate,ColorInterpolator,,2047
animate,interpolate,DateInterpolator,,1375
animate,interpolate,Interpolator,,8746
animate,interpolate,MatrixInterpolator,,2202
animate,interpolate,NumberInterpolator,,1382
animate,interpolate,ObjectInterpolator,,1629
animate,interpolate,PointInterpolator,,1675
animate,interpolate,RectangleInterpolator,,2042
animate,Easing,,,17010
animate,FunctionSequence,,,5842
animate,ISchedulable,,,1041
animate,Parallel,,,5176
animate,Pause,,,449
animate,Scheduler,,,5593
animate,Sequence,,,5534
animate,Transition,,,9201
animate,Transitioner,,,19975
animate,TransitionEvent,,,1116
animate,Tween,,,6006
scale,IScaleMap,,,2105
scale,LinearScale,,,1316
scale,LogScale,,,3151
scale,OrdinalScale,,,3770
scale,QuantileScale,,,2435
scale,QuantitativeScale,,,4839
scale,RootScale,,,1756
scale,Scale,,,4268
scale,ScaleType,,,1821
scale,TimeScale,,,5833
physics,DragForce,,,1082
physics,GravityForce,,,1336
physics,IForce,,,319
physics,NBodyForce,,,10498
physics,Particle,,,2822
physics,Simulation,,,9983
physics,Spring,,,2213
physics,SpringForce,,,1681
data,converters,Converters,,721
data,converters,DelimitedTextConverter,,4294
data,converters,GraphMLConverter,,9800
data,converters,IDataConverter,,1314
data,converters,JSONConverter,,2220
data,DataField,,,1759
data,DataSchema,,,2165
data,DataSet,,,586
data,DataSource,,,3331
data,DataTable,,,772
data,DataUtil,,,3322
vis,controls,AnchorControl,,2138
vis,controls,ClickControl,,3824
vis,controls,Control,,1353
vis,controls,ControlList,,4665
vis,controls,DragControl,,2649
vis,controls,ExpandControl,,2832
vis,controls,HoverControl,,4896
vis,controls,IControl,,763
vis,controls,PanZoomControl,,5222
vis,controls,SelectionControl,,7862
vis,controls,TooltipControl,,8435
vis,operator,layout,AxisLayout,6725
vis,operator,layout,BundledEdgeRouter,3727
vis,operator,layout,CircleLayout,9317
vis,operator,layout,CirclePackingLayout,12003
vis,operator,layout,DendrogramLayout,4853
vis,operator,layout,ForceDirectedLayout,8411
vis,operator,layout,IcicleTreeLayout,4864
vis,operator,layout,IndentedTreeLayout,3174
vis,operator,layout,Layout,7881
vis,operator,layout,NodeLinkTreeLayout,12870
vis,operator,layout,PieLayout,2728
vis,operator,layout,RadialTreeLayout,12348
vis,operator,layout,RandomLayout,870
vis,operator,layout,StackedAreaLayout,9121
vis,operator,layout,TreeMapLayout,9191
vis,operator,encoder,ColorEncoder,3179
vis,operator,encoder,Encoder,4060
vis,operator,encoder,PropertyEncoder,4138
vis,operator,encoder,ShapeEncoder,1690
vis,operator,encoder,valueEncoder,1830
vis,operator,distortion,BifocalDistortion,4461
vis,operator,distortion,Distortion,6314
vis,operator,distortion,FisheyeDistortion,3444
vis,operator,filter,FisheyeTreeFilter,5219
vis,operator,filter,GraphDistanceFilter,3165
vis,operator,filter,VisibilityFilter,3509
vis,operator,label,Labeler,9956
vis,operator,label,RadialLabeler,3899
vis,operator,label,StackedAreaLabeler,3202
vis,operator,IOperator,,1286
vis,operator,Operator,,2490
vis,operator,OperatorList,,5248
vis,operator,OperatorSequence,,4190
vis,operator,OperatorSwitch,,2581
vis,operator,SortOperator,,2023
vis,data,render,ArrowType,698
vis,data,render,EdgeRenderer,5569
vis,data,render,IRenderer,353
vis,data,render,ShapeRenderer,2247
vis,data,Data,,20544
vis,data,DataList,,19788
vis,data,DataSprite,,10349
vis,data,EdgeSprite,,3301
vis,data,NodeSprite,,19382
vis,data,ScaleBinding,,11275
vis,data,Tree,,7147
vis,data,TreeBuilder,,9930
vis,axis,Axes,,1302
vis,axis,Axis,,24593
vis,axis,AxisGridLine,,652
vis,axis,AxisLabel,,636
vis,axis,CartesianAxes,,6703
vis,events,DataEvent,,2313
vis,events,SelectionEvent,,1880
vis,events,TooltipEvent,,1701
vis,events,VisualizationEvent,,1117
vis,legend,Legend,,20859
vis,legend,LegendItem,,4614
vis,legend,LegendRange,,10530
vis,Visualization,,,16540
display,DirtySprite,,,8833
display,LineSprite,,,1732
display,RectSprite,,,3623
display,TextSprite,,,10066
analytics,graph,BetweennessCentrality,,3534
analytics,graph,LinkDistance,,5731
analytics,graph,MaxFlowMinCut,,7840
analytics,graph,ShortestPaths,,5914
analytics,graph,SpanningTree,,3416
analytics,cluster,AgglomerativeCluster,,3938
analytics,cluster,CommunityStructure,,3812
analytics,cluster,HierarchicalCluster,,6714
analytics,cluster,MergeEdge,,743
analytics,optimization,AspectRatioBanker,,7074
flex,FlareVis,,,4116`);
    const context = {
      chartTypeList: Object.values(ChartType),
      dataTable: dataset,
      command: 'Genarate a basic treemap chart',
      cell: {
        color: ['Category-0', 'Category-1', 'Category-2', 'Category-3'],
        size: 'value'
      },
      chartType: ChartType.TreemapChart.toUpperCase()
    };
    const { chartType, spec } = getChartSpecWithContext(context);
    expect(chartType).toBe(ChartType.TreemapChart);
    expect(spec.type).toBe('treemap');
    expect(spec.categoryField).toBe('name');
    expect(spec.valueField).toBe('value');
    expect(spec.label.visible).toBe(true);
  });

  it('should generate correct basic treemap spec with one color', () => {
    const { dataset } = parseCSVData(`Category-0,value
add,593
and,330
average,287
count,277
distinct,292
div,595
eq,594
fn,460
gt,603
gte,625
iff,748
isa,461
lt,597
lte,619
max,283
min,283
mod,591
mul,603
neq,599
not,386
or,323
orderby,307
range,772
select,296
stddev,363
sub,600
sum,280
update,307
variance,335
where,299
xor,354
_,264
AggregateExpression,1616
And,1027
Arithmetic,3891
Average,891
BinaryExpression,2893
Comparison,5103
CompositeExpression,3677
Count,781
DateUtil,4141
Distinct,933
Expression,5130
ExpressionIterator,3617
Fn,3240
If,2732
IsA,2039
Literal,1214
Match,3748
Maximum,843
Minimum,843
Not,1554
Or,970
Query,13896
Range,1594
StringUtil,4130
Sum,791
Variable,1124
Variance,1876
Xor,1101
ColorPalette,6367
Palette,1229
ShapePalette,2059
valuePalette,2291
DenseMatrix,3165
IMatrix,2815
SparseMatrix,3366
FibonacciHeap,9354
HeapNode,1233
Arrays,8258
Colors,10001
Dates,8217
Displays,12555
Filter,2324
Geometry,10993
IEvaluable,335
IPredicate,383
IValueProxy,874
Maths,17705
Orientation,1486
Property,5559
Shapes,19118
Sort,6887
Stats,6557
Strings,22026
ArrayInterpolator,1983
ColorInterpolator,2047
DateInterpolator,1375
Interpolator,8746
MatrixInterpolator,2202
NumberInterpolator,1382
ObjectInterpolator,1629
PointInterpolator,1675
RectangleInterpolator,2042
Easing,17010
FunctionSequence,5842
ISchedulable,1041
Parallel,5176
Pause,449
Scheduler,5593
Sequence,5534
Transition,9201
Transitioner,19975
TransitionEvent,1116
Tween,6006
IScaleMap,2105
LinearScale,1316
LogScale,3151
OrdinalScale,3770
QuantileScale,2435
QuantitativeScale,4839
RootScale,1756
Scale,4268
ScaleType,1821
TimeScale,5833
DragForce,1082
GravityForce,1336
IForce,319
NBodyForce,10498
Particle,2822
Simulation,9983
Spring,2213
SpringForce,1681
Converters,721
DelimitedTextConverter,4294
GraphMLConverter,9800
IDataConverter,1314
JSONConverter,2220
DataField,1759
DataSchema,2165
DataSet,586
DataSource,3331
DataTable,772
DataUtil,3322
AnchorControl,2138
ClickControl,3824
Control,1353
ControlList,4665
DragControl,2649
ExpandControl,2832
HoverControl,4896
IControl,763
PanZoomControl,5222
SelectionControl,7862
TooltipControl,8435
AxisLayout,6725
BundledEdgeRouter,3727
CircleLayout,9317
CirclePackingLayout,12003
DendrogramLayout,4853
ForceDirectedLayout,8411
IcicleTreeLayout,4864
IndentedTreeLayout,3174
Layout,7881
NodeLinkTreeLayout,12870
PieLayout,2728
RadialTreeLayout,12348
RandomLayout,870
StackedAreaLayout,9121
TreeMapLayout,9191
ColorEncoder,3179
Encoder,4060
PropertyEncoder,4138
ShapeEncoder,1690
valueEncoder,1830
BifocalDistortion,4461
Distortion,6314
FisheyeDistortion,3444
FisheyeTreeFilter,5219
GraphDistanceFilter,3165
VisibilityFilter,3509
Labeler,9956
RadialLabeler,3899
StackedAreaLabeler,3202
IOperator,1286
Operator,2490
OperatorList,5248
OperatorSequence,4190
OperatorSwitch,2581
SortOperator,2023
ArrowType,698
EdgeRenderer,5569
IRenderer,353
ShapeRenderer,2247
Data,20544
DataList,19788
DataSprite,10349
EdgeSprite,3301
NodeSprite,19382
ScaleBinding,11275
Tree,7147
TreeBuilder,9930
Axes,1302
Axis,24593
AxisGridLine,652
AxisLabel,636
CartesianAxes,6703
DataEvent,2313
SelectionEvent,1880
TooltipEvent,1701
VisualizationEvent,1117
Legend,20859
LegendItem,4614
LegendRange,10530
Visualization,16540
DirtySprite,8833
LineSprite,1732
RectSprite,3623
TextSprite,10066
BetweennessCentrality,3534
LinkDistance,5731
MaxFlowMinCut,7840
ShortestPaths,5914
SpanningTree,3416
AgglomerativeCluster,3938
CommunityStructure,3812
HierarchicalCluster,6714
MergeEdge,743
AspectRatioBanker,7074
FlareVis,4116`);
    const context = {
      chartTypeList: Object.values(ChartType),
      dataTable: dataset,
      command: 'Genarate a basic treemap chart',
      cell: {
        color: 'Category-0',
        size: 'value'
      },
      chartType: ChartType.TreemapChart.toUpperCase()
    };
    const { chartType, spec } = getChartSpecWithContext(context);
    expect(chartType).toBe(ChartType.TreemapChart);
    expect(spec.type).toBe('treemap');
    expect(spec.categoryField).toBe('name');
    expect(spec.valueField).toBe('value');
    expect(spec.label.visible).toBe(true);
  });
});
